<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>ì¹˜í‚¨ ì–´ë•Œ ğŸ—</title>

    <!-- Bulma CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css">


    <!-- Bootstrap CSS -->

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    {#    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"#}
    {#          integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"#}
    {#          crossorigin="anonymous">#}

    <!-- í°íŠ¸-->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Hahmlet:wght@400&display=swap"
          rel="stylesheet">
    <!-- css íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸° (ë°°ë„ˆ, ë°°ê²½)-->
    <link href='{{ url_for("static", filename="mystyle.css") }}' rel="stylesheet">

    <!-- JavaScript Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
            crossorigin="anonymous"></script>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
            integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
            crossorigin="anonymous"></script>

    <!-- JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>

    <style>
        .img-box {
            display: inline-block;
            width: 200px;
            height: 200px;
            text-align: center;
        {#float: left;#}{#margin: auto;#} padding: 10px;
        }

        .container {
            width: 80%;
            max-width: 800px;
            margin: 30px auto;
            padding: 20px;
            background-color: white;
            border: solid 1px gray;
            border-radius: 10px;
            text-align: center;
        }

        span.example {
            color: gray;
            font-size: 14px;
        }

        .btn-sparta {
            color: #fff;
            background-color: #e8344e;
            border-color: #e8344e;
        }

        .btn-outline-sparta {
            color: #e8344e;
            background-color: transparent;
            background-image: none;
            border-color: #e8344e;
        }


    </style>
    <script>
        let target = "{{ target }}"
        $(document).ready(function () {
            $("#post-box").empty();
            get_posts();
        })


        function sign_out() {
            $.removeCookie('mytoken', {path: '/'})
            alert('ë¡œê·¸ì•„ì›ƒ!')
            window.location.href = "/login"
        }

        function post() {
            let star = $('#star-select').val();
            let comment = $('#textarea-post').val();
            let today = new Date().toISOString();
            let target = "{{ chicken.name }}";


            if (comment == ""|| star == "ë‚˜ì˜ ì ìˆ˜ëŠ”?") {
                // commentë‚˜ star ì…ë ¥ ë€ì— ê°’ì´ ì—†ìœ¼ë©´ ë©”ì‹œì§€
                if(comment == "") alert('ë¦¬ë·°ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”')
                else alert('ë³„ì ì„ ì…ë ¥í•´ì£¼ì„¸ìš”')

            } else {
                // ì…ë ¥ ê°’ ìˆìœ¼ë©´ ì„œë²„ì— ì…ë ¥ ì •ë³´ ë³´ë‚´ê¸°
                $.ajax({
                type: "POST",
                url: "/posting",
                data: {
                    target_give: target,
                    star_give: star,
                    comment_give: comment,
                    date_give: today
                },
                success: function (response) {
                    //ì„±ê³µí•˜ë©´ ëª¨ë‹¬ì°½ ë‹«ê¸°
                    $("#modal-post").removeClass("is-active")
                    window.location.href = "/detail/{{ chicken.name }}"
                }
            })


            }

        }


        // function find_chicken() {
        //     let chicken = $("#input-chicken").val().toLowerCase()
        //     if (chicken == "") {
        //         alert("ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”")
        //         return
        //     }
        //     if (chicken_list.includes(chicken)) {
        //         //ë¦¬ìŠ¤íŠ¸ì— ìˆìœ¼ë©´ í•˜ì´ë¼ì´íŠ¸
        //         alert('ì°¾ì•˜ìŠµë‹ˆë‹¤!')
        //         $(`#chicken-${chicken}`).addClass("highlight")
        //         $(`#chicken-${chicken}`).siblings().removeClass("highlight")
        //         $(`#chicken-${chicken}`)[0].scrollIntoView()
        //
        //     } else {
        //         //ë¦¬ìŠ¤íŠ¸ì— ì—†ìœ¼ë©´ ë©”ì‹œì§€
        //         alert('ê·¸ëŸ° ì¹˜í‚¨ì€ ì—†ì–´ìš”...')
        //         window.location.href = '/'
        //     }
        // }


        function get_posts() {
            $.ajax({
                type: "GET",
                url: `/get_posts?target_give=${target}`,
                data: {},
                success: function (response) {
                    if (response["result"] == "success") {
                        console.log(response["posts"])
                        let posts = response["posts"]
                        for (let i = 0; i < posts.length; i++) {
                            let post = posts[i]
                            let time_post = new Date(post["date"])
                            let time_before = time2str(time_post)
                            let html_temp = `<div class="box" id="${post["_id"]}">
                                            <article class="media">
                                                <div class="media-left">
                                                    <figure class="image is-96x96">
                                                     <img src="/static/chicken.png" alt="Image" style="object-fit: cover">
                                                    </figure>
                                                </div>
                                                <div class="media-content">
                                                    <div class="content">
                                                        <p>
                                                             <strong>${post['username']}</strong>
                                                            <br> ${post['star']} <small>${time_before}</small>
                                                              <br>
                                                               <br>${post['comment']}


                                                        </p>
                                                    </div>

                                                </div>
                                            </article>
                                        </div>`
                            $("#post-box").append(html_temp)
                        }
                    }
                }
            })
        }

        function time2str(date) {
            let today = new Date()
            let time = (today - date) / 1000 / 60 // ë¶„
            if (time < 60) {
                return parseInt(time) + "ë¶„ ì „"
            }
            time = time / 60 // ì‹œê°„
            if (time < 24) {
                return parseInt(time) + "ì‹œê°„ ì „"
            }
            time = time / 24
            if (time < 7) {
                return parseInt(time) + "ì¼ ì „"
            }
            return `${date.getFullYear()}ë…„ ${date.getMonth() + 1}ì›” ${date.getDate()}ì¼`
        }

        function num2str(count) {
            if (count > 10000) {
                return parseInt(count / 1000) + "k"
            }
            if (count > 500) {
                return parseInt(count / 100) / 10 + "k"
            }
            if (count == 0) {
                return ""
            }
            return count
        }

    </script>
</head>
<body>
<div class="wrap"> {# ì „ì²´ div #}
    <a href="" class="badge rounded-pill bg-secondary logout" style="text-decoration-line: none" onclick="sign_out()">ë¡œê·¸ì•„ì›ƒ</a>
    <div class="banner" onclick="window.location.href = '/'"> {#ë°°ë„ˆ#} </div>

    <div class="contents">

        <div class="container">
            <div class="img-box"><img src="{{ chicken.img_url }}" class="card-img-top h-70" alt="...">
            </div>
            <div class="d-flex justify-content-between align-items-end">
                <div>
                    <h1 id="word" style="display: inline;">{{ chicken.name }}</h1>
                    <h5 id="pronunciation" style="display: inline;">{{ chicken.brand }}</h5>
                </div>
                <button onclick="window.location.href = '/'" id="btn-save" class="btn btn-outline-sparta btn-md">ëŒì•„ê°€ê¸°
                </button>
            </div>
            <hr>
            <div id="definitions">
                <div style="padding:10px">

                    <br>{{ chicken.status }}<br>
                    <span class="example"></span>
                </div>
            </div>
        </div>
    </div>

    <div class="review-box">
        <section class="section">
            <article class="media">
                <figure class="media-left" style="align-self: center; color: #ffc107">
                    <i class="fa fa-comments-o fa-2x" aria-hidden="true"></i>
                </figure>
                <div class="media-content">
                    <div class="field">
                        <p class="control">
                            <input id="input-post" class="input is-rounded " placeholder="ì–´ë–¤ ë§›ì¸ê°€ìš”?"
                                   onclick='$("#modal-post").addClass("is-active")' autocomplete="off">
                        </p>
                    </div>
                </div>
            </article>
            <div class="modal" id="modal-post">
                <div class="modal-background" onclick='$("#modal-post").removeClass("is-active")'></div>
                <div class="modal-content">
                    <div class="box">
                        <article class="media">
                            <div class="media-content">
                                <div class="field">
                                    <p class="control">
                                    <div class="select is-warning">
                                        <select id="star-select">
                                            <option>ë‚˜ì˜ ì ìˆ˜ëŠ”?</option>
                                            <option>â­</option>
                                            <option>â­â­</option>
                                            <option>â­â­â­</option>
                                            <option>â­â­â­â­</option>
                                            <option>â­â­â­â­â­</option>
                                        </select>
                                    </div>
                                    <textarea id="textarea-post" class="textarea"
                                              placeholder="ë¦¬ë·°ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš” :)"></textarea>
                                    </p>
                                </div>
                                <nav class="level is-mobile">
                                    <div class="level-left">
                                    </div>
                                    <div class="level-right">
                                        <div class="level-item">
                                            <a class="button is-warning" onclick="post()" style="text-decoration-line: none">í¬ìŠ¤íŒ…í•˜ê¸°</a>
                                        </div>
                                        <div class="level-item">
                                            <a class="button is-warning is-outlined"
                                               onclick='$("#modal-post").removeClass("is-active")' style="text-decoration-line: none">ì·¨ì†Œ</a>
                                        </div>
                                    </div>
                                </nav>
                            </div>
                        </article>
                    </div>
                </div>
                <button class="modal-close is-large" aria-label="close"
                        onclick='$("#modal-post").removeClass("is-active")'></button>
            </div>
        </section>
    </div>
    <div class="review-list">

        <section class="section">
            <div id="post-box" class="">
                <div class="box">
                    <article class="media">
                        <div class="media-left">
                            <figure class="image is-64x64">
                                <img src="https://bulma.io/images/placeholders/128x128.png" alt="Image">
                            </figure>
                        </div>
                        <div class="media-content">
                            <div class="content">
                                <p>
                                    <strong>John Smith</strong> <small>@johnsmith</small> <small>31m</small>
                                    <br>
                                    Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean efficitur sit amet
                                    massa fringilla egestas. Nullam condimentum luctus turpis.
                                </p>
                            </div>
                            <nav class="level is-mobile">
                                <div class="level-left">
                                    <a class="level-item" aria-label="reply">
            <span class="icon is-small">
              <i class="fas fa-reply" aria-hidden="true"></i>
            </span>
                                    </a>
                                    <a class="level-item" aria-label="retweet">
            <span class="icon is-small">
              <i class="fas fa-retweet" aria-hidden="true"></i>
            </span>
                                    </a>
                                    <a class="level-item" aria-label="like">
            <span class="icon is-small">
              <i class="fas fa-heart" aria-hidden="true"></i>
            </span>
                                    </a>
                                </div>
                            </nav>
                        </div>
                    </article>
                </div>
            </div>
        </section>

    </div>


</div>


</body>
</html>